<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Penlight Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Penlight</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../source/app.lua.html">app.lua</a></li>
  <li><a href="../source/array2d.lua.html">array2d.lua</a></li>
  <li><a href="../source/class.lua.html">class.lua</a></li>
  <li><a href="../source/compat.lua.html">compat.lua</a></li>
  <li><a href="../source/comprehension.lua.html">comprehension.lua</a></li>
  <li><a href="../source/config.lua.html">config.lua</a></li>
  <li><a href="../source/data.lua.html">data.lua</a></li>
  <li><a href="../source/date.lua.html">date.lua</a></li>
  <li><a href="../source/dir.lua.html">dir.lua</a></li>
  <li><a href="../source/file.lua.html">file.lua</a></li>
  <li><a href="../source/func.lua.html">func.lua</a></li>
  <li><a href="../source/import_into.lua.html">import_into.lua</a></li>
  <li><a href="../source/init.lua.html">init.lua</a></li>
  <li><a href="../source/input.lua.html">input.lua</a></li>
  <li><a href="../source/lapp.lua.html">lapp.lua</a></li>
  <li><a href="../source/lexer.lua.html">lexer.lua</a></li>
  <li><a href="../source/list.lua.html">list.lua</a></li>
  <li><a href="../source/luabalanced.lua.html">luabalanced.lua</a></li>
  <li><a href="../source/map.lua.html">map.lua</a></li>
  <li><a href="../source/multimap.lua.html">multimap.lua</a></li>
  <li><a href="../source/operator.lua.html">operator.lua</a></li>
  <li><a href="../source/orderedmap.lua.html">orderedmap.lua</a></li>
  <li><a href="../source/path.lua.html">path.lua</a></li>
  <li><a href="../source/permute.lua.html">permute.lua</a></li>
  <li><a href="../source/pretty.lua.html">pretty.lua</a></li>
  <li><a href="../source/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../source/seq.lua.html">seq.lua</a></li>
  <li><a href="../source/set.lua.html">set.lua</a></li>
  <li><a href="../source/sip.lua.html">sip.lua</a></li>
  <li><a href="../source/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../source/strict.lua.html">strict.lua</a></li>
  <li><strong>stringio.lua</strong></li>
  <li><a href="../source/stringx.lua.html">stringx.lua</a></li>
  <li><a href="../source/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../source/tablex.lua.html">tablex.lua</a></li>
  <li><a href="../source/template.lua.html">template.lua</a></li>
  <li><a href="../source/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../source/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../source/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../source/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../source/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../source/test.lua.html">test.lua</a></li>
  <li><a href="../source/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../source/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../source/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../source/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../source/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../source/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../source/testxml.lua.html">testxml.lua</a></li>
  <li><a href="../source/text.lua.html">text.lua</a></li>
  <li><a href="../source/types.lua.html">types.lua</a></li>
  <li><a href="../source/url.lua.html">url.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/which.lua.html">which.lua</a></li>
  <li><a href="../source/xml.lua.html">xml.lua</a></li>
</ul>
<h2>Libraries</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../libraries/pl.html">pl</a></li>
  <li><a href="../libraries/pl.app.html">pl.app</a></li>
  <li><a href="../libraries/pl.array2d.html">pl.array2d</a></li>
  <li><a href="../libraries/pl.class.html">pl.class</a></li>
  <li><a href="../libraries/pl.compat.html">pl.compat</a></li>
  <li><a href="../libraries/pl.comprehension.html">pl.comprehension</a></li>
  <li><a href="../libraries/pl.config.html">pl.config</a></li>
  <li><a href="../libraries/pl.data.html">pl.data</a></li>
  <li><a href="../libraries/pl.dir.html">pl.dir</a></li>
  <li><a href="../libraries/pl.file.html">pl.file</a></li>
  <li><a href="../libraries/pl.func.html">pl.func</a></li>
  <li><a href="../libraries/pl.import_into.html">pl.import_into</a></li>
  <li><a href="../libraries/pl.input.html">pl.input</a></li>
  <li><a href="../libraries/pl.lapp.html">pl.lapp</a></li>
  <li><a href="../libraries/pl.lexer.html">pl.lexer</a></li>
  <li><a href="../libraries/pl.luabalanced.html">pl.luabalanced</a></li>
  <li><a href="../libraries/pl.operator.html">pl.operator</a></li>
  <li><a href="../libraries/pl.path.html">pl.path</a></li>
  <li><a href="../libraries/pl.permute.html">pl.permute</a></li>
  <li><a href="../libraries/pl.pretty.html">pl.pretty</a></li>
  <li><a href="../libraries/pl.seq.html">pl.seq</a></li>
  <li><a href="../libraries/pl.sip.html">pl.sip</a></li>
  <li><a href="../libraries/pl.strict.html">pl.strict</a></li>
  <li><a href="../libraries/pl.stringio.html">pl.stringio</a></li>
  <li><a href="../libraries/pl.stringx.html">pl.stringx</a></li>
  <li><a href="../libraries/pl.tablex.html">pl.tablex</a></li>
  <li><a href="../libraries/pl.template.html">pl.template</a></li>
  <li><a href="../libraries/pl.test.html">pl.test</a></li>
  <li><a href="../libraries/pl.text.html">pl.text</a></li>
  <li><a href="../libraries/pl.types.html">pl.types</a></li>
  <li><a href="../libraries/pl.url.html">pl.url</a></li>
  <li><a href="../libraries/pl.utils.html">pl.utils</a></li>
  <li><a href="../libraries/pl.xml.html">pl.xml</a></li>
</ul>
<h2>Classes</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../classes/pl.Date.html">pl.Date</a></li>
  <li><a href="../classes/pl.List.html">pl.List</a></li>
  <li><a href="../classes/pl.Map.html">pl.Map</a></li>
  <li><a href="../classes/pl.MultiMap.html">pl.MultiMap</a></li>
  <li><a href="../classes/pl.OrderedMap.html">pl.OrderedMap</a></li>
  <li><a href="../classes/pl.Set.html">pl.Set</a></li>
</ul>
<h2>Manual</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
  <li><a href="../manual/02-arrays.md.html">Tables and Arrays</a></li>
  <li><a href="../manual/03-strings.md.html">Strings. Higher-level operations on strings.</a></li>
  <li><a href="../manual/04-paths.md.html">Paths and Directories</a></li>
  <li><a href="../manual/05-dates.md.html">Date and Time</a></li>
  <li><a href="../manual/06-data.md.html">Data</a></li>
  <li><a href="../manual/07-functional.md.html">Functional Programming</a></li>
  <li><a href="../manual/08-additional.md.html">Additional Libraries</a></li>
  <li><a href="../manual/09-discussion.md.html">Technical Choices</a></li>
</ul>
<h2>Examples</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../examples/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../examples/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../examples/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../examples/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../examples/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../examples/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../examples/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../examples/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../examples/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../examples/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../examples/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../examples/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../examples/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../examples/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../examples/testxml.lua.html">testxml.lua</a></li>
  <li><a href="../examples/which.lua.html">which.lua</a></li>
</ul>

</div>

<div id="content">

    <h2>stringio.lua</h2>
<pre>
<span class="comment">--- Reading and writing strings using file-like objects. &lt;br&gt;
</span><span class="comment">--
</span><span class="comment">--    f = stringio.open(text)
</span><span class="comment">--    l1 = f:read()  -- read first line
</span><span class="comment">--    n,m = f:read ('*n','*n') -- read two numbers
</span><span class="comment">--    for line in f:lines() do print(line) end -- iterate over all lines
</span><span class="comment">--    f = stringio.create()
</span><span class="comment">--    f:write('hello')
</span><span class="comment">--    f:write('dolly')
</span><span class="comment">--    assert(f:value(),'hellodolly')
</span><span class="comment">--
</span><span class="comment">-- See  <a href="../manual/03-strings.md.html#File_style_I_O_on_Strings">the Guide</a>.
</span><span class="comment">-- @module pl.stringio
</span>
<span class="keyword">local</span> <span class="global">unpack</span> = <span class="global">rawget</span>(_G,<span class="string">'unpack'</span>) <span class="keyword">or</span> <span class="global">rawget</span>(<span class="global">table</span>,<span class="string">'unpack'</span>)
<span class="keyword">local</span> <span class="global">getmetatable</span>,<span class="global">tostring</span>,<span class="global">tonumber</span> = <span class="global">getmetatable</span>,<span class="global">tostring</span>,<span class="global">tonumber</span>
<span class="keyword">local</span> concat,append = <span class="global">table</span>.concat,<span class="global">table</span>.insert

<span class="keyword">local</span> stringio = {}

<span class="comment">-- Writer class
</span><span class="keyword">local</span> SW = {}
SW.__index = SW

<span class="keyword">local</span> <span class="keyword">function</span> xwrite(self,...)
    <span class="keyword">local</span> args = {...} <span class="comment">--arguments may not be nil!
</span>    <span class="keyword">for</span> i = <span class="number">1</span>, #args <span class="keyword">do</span>
        append(self.tbl,args[i])
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> SW:write(arg1,arg2,...)
    <span class="keyword">if</span> arg2 <span class="keyword">then</span>
        xwrite(self,arg1,arg2,...)
    <span class="keyword">else</span>
        append(self.tbl,arg1)
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> SW:writef(fmt,...)
    self:write(fmt:format(...))
<span class="keyword">end</span>

<span class="keyword">function</span> SW:value()
    <span class="keyword">return</span> concat(self.tbl)
<span class="keyword">end</span>

<span class="keyword">function</span> SW:__tostring()
    <span class="keyword">return</span> self:value()
<span class="keyword">end</span>

<span class="keyword">function</span> SW:close() <span class="comment">-- for compatibility only
</span><span class="keyword">end</span>

<span class="keyword">function</span> SW:seek()
<span class="keyword">end</span>

<span class="comment">-- Reader class
</span><span class="keyword">local</span> SR = {}
SR.__index = SR

<span class="keyword">function</span> SR:_read(fmt)
    <span class="keyword">local</span> i,str = self.i,self.str
    <span class="keyword">local</span> sz = #str
    <span class="keyword">if</span> i &gt; sz <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">nil</span> <span class="keyword">end</span>
    <span class="keyword">local</span> res
    <span class="keyword">if</span> fmt == <span class="string">'*l'</span> <span class="keyword">or</span> fmt == <span class="string">'*L'</span> <span class="keyword">then</span>
        <span class="keyword">local</span> idx = str:find(<span class="string">'\n'</span>,i) <span class="keyword">or</span> (sz+<span class="number">1</span>)
        res = str:sub(i,fmt == <span class="string">'*l'</span> <span class="keyword">and</span> idx-<span class="number">1</span> <span class="keyword">or</span> idx)
        self.i = idx+<span class="number">1</span>
    <span class="keyword">elseif</span> fmt == <span class="string">'*a'</span> <span class="keyword">then</span>
        res = str:sub(i)
        self.i = sz
    <span class="keyword">elseif</span> fmt == <span class="string">'*n'</span> <span class="keyword">then</span>
        <span class="keyword">local</span> _,i2,i2,idx
        _,idx = str:find (<span class="string">'%s*%d+'</span>,i)
        _,i2 = str:find (<span class="string">'^%.%d+'</span>,idx+<span class="number">1</span>)
        <span class="keyword">if</span> i2 <span class="keyword">then</span> idx = i2 <span class="keyword">end</span>
        _,i2 = str:find (<span class="string">'^[eE][%+%-]*%d+'</span>,idx+<span class="number">1</span>)
        <span class="keyword">if</span> i2 <span class="keyword">then</span> idx = i2 <span class="keyword">end</span>
        <span class="keyword">local</span> val = str:sub(i,idx)
        res = <span class="global">tonumber</span>(val)
        self.i = idx+<span class="number">1</span>
    <span class="keyword">elseif</span> <span class="global">type</span>(fmt) == <span class="string">'number'</span> <span class="keyword">then</span>
        res = str:sub(i,i+fmt-<span class="number">1</span>)
        self.i = i + fmt
    <span class="keyword">else</span>
        error(<span class="string">"bad read format"</span>,<span class="number">2</span>)
    <span class="keyword">end</span>
    <span class="keyword">return</span> res
<span class="keyword">end</span>

<span class="keyword">function</span> SR:read(...)
    <span class="keyword">if</span> <span class="global">select</span>(<span class="string">'#'</span>,...) == <span class="number">0</span> <span class="keyword">then</span>
        <span class="keyword">return</span> self:_read(<span class="string">'*l'</span>)
    <span class="keyword">else</span>
        <span class="keyword">local</span> res, fmts = {},{...}
        <span class="keyword">for</span> i = <span class="number">1</span>, #fmts <span class="keyword">do</span>
            res[i] = self:_read(fmts[i])
        <span class="keyword">end</span>
        <span class="keyword">return</span> <span class="global">unpack</span>(res)
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> SR:seek(whence,offset)
    <span class="keyword">local</span> base
    whence = whence <span class="keyword">or</span> <span class="string">'cur'</span>
    offset = offset <span class="keyword">or</span> <span class="number">0</span>
    <span class="keyword">if</span> whence == <span class="string">'set'</span> <span class="keyword">then</span>
        base = <span class="number">1</span>
    <span class="keyword">elseif</span> whence == <span class="string">'cur'</span> <span class="keyword">then</span>
        base = self.i
    <span class="keyword">elseif</span> whence == <span class="string">'end'</span> <span class="keyword">then</span>
        base = #self.str
    <span class="keyword">end</span>
    self.i = base + offset
    <span class="keyword">return</span> self.i
<span class="keyword">end</span>

<span class="keyword">function</span> SR:lines(...)
    <span class="keyword">local</span> n, args = <span class="global">select</span>(<span class="string">'#'</span>,...)
    <span class="keyword">if</span> n &gt; <span class="number">0</span> <span class="keyword">then</span>
        args = {...}
    <span class="keyword">end</span>
    <span class="keyword">return</span> <span class="keyword">function</span>()
        <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">then</span>
            <span class="keyword">return</span> self:_read <span class="string">'*l'</span>
        <span class="keyword">else</span>
            <span class="keyword">return</span> self:read(<span class="global">unpack</span>(args))
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">function</span> SR:close() <span class="comment">-- for compatibility only
</span><span class="keyword">end</span>

<span class="comment">--- create a file-like object which can be used to construct a string.
</span><span class="comment">-- The resulting object has an extra <code>value()</code> method for
</span><span class="comment">-- retrieving the string value.  Implements <a href="http://www.lua.org/manual/5.1/manual.html#pdf-file:write">file:write</a>, <a href="http://www.lua.org/manual/5.1/manual.html#pdf-file:seek">file:seek</a>, <a href="http://www.lua.org/manual/5.1/manual.html#pdf-file:lines">file:lines</a>,
</span><span class="comment">-- plus an extra <code>writef</code> method which works like <a href="../libraries/pl.utils.html#printf">utils.printf</a>.
</span><a id="142"></a><span class="comment">-- @usage f = create(); f:write('hello, dolly\n'); print(f:value())
</span><span class="keyword">function</span> stringio.create()
    <span class="keyword">return</span> <span class="global">setmetatable</span>({tbl={}},SW)
<span class="keyword">end</span>

<span class="comment">--- create a file-like object for reading from a given string.
</span><span class="comment">-- Implements <a href="http://www.lua.org/manual/5.1/manual.html#pdf-file:read">file:read</a>.
</span><span class="comment">-- @string s The input string.
</span><a id="150"></a><span class="comment">-- @usage fs = open '20 10'; x,y = f:read ('*n','*n'); assert(x == 20 and y == 10)
</span><span class="keyword">function</span> stringio.open(s)
    <span class="keyword">return</span> <span class="global">setmetatable</span>({str=s,i=<span class="number">1</span>},SR)
<span class="keyword">end</span>

<span class="keyword">function</span> stringio.lines(s,...)
    <span class="keyword">return</span> stringio.open(s):lines(...)
<span class="keyword">end</span>

<span class="keyword">return</span> stringio</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.3</a></i>
<i style="float:right;">Last updated 2014-11-01 18:36:39 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
