<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Penlight Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Penlight</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../source/app.lua.html">app.lua</a></li>
  <li><a href="../source/array2d.lua.html">array2d.lua</a></li>
  <li><strong>class.lua</strong></li>
  <li><a href="../source/compat.lua.html">compat.lua</a></li>
  <li><a href="../source/comprehension.lua.html">comprehension.lua</a></li>
  <li><a href="../source/config.lua.html">config.lua</a></li>
  <li><a href="../source/data.lua.html">data.lua</a></li>
  <li><a href="../source/date.lua.html">date.lua</a></li>
  <li><a href="../source/dir.lua.html">dir.lua</a></li>
  <li><a href="../source/file.lua.html">file.lua</a></li>
  <li><a href="../source/func.lua.html">func.lua</a></li>
  <li><a href="../source/import_into.lua.html">import_into.lua</a></li>
  <li><a href="../source/init.lua.html">init.lua</a></li>
  <li><a href="../source/input.lua.html">input.lua</a></li>
  <li><a href="../source/lapp.lua.html">lapp.lua</a></li>
  <li><a href="../source/lexer.lua.html">lexer.lua</a></li>
  <li><a href="../source/list.lua.html">list.lua</a></li>
  <li><a href="../source/luabalanced.lua.html">luabalanced.lua</a></li>
  <li><a href="../source/map.lua.html">map.lua</a></li>
  <li><a href="../source/multimap.lua.html">multimap.lua</a></li>
  <li><a href="../source/operator.lua.html">operator.lua</a></li>
  <li><a href="../source/orderedmap.lua.html">orderedmap.lua</a></li>
  <li><a href="../source/path.lua.html">path.lua</a></li>
  <li><a href="../source/permute.lua.html">permute.lua</a></li>
  <li><a href="../source/pretty.lua.html">pretty.lua</a></li>
  <li><a href="../source/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../source/seq.lua.html">seq.lua</a></li>
  <li><a href="../source/set.lua.html">set.lua</a></li>
  <li><a href="../source/sip.lua.html">sip.lua</a></li>
  <li><a href="../source/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../source/strict.lua.html">strict.lua</a></li>
  <li><a href="../source/stringio.lua.html">stringio.lua</a></li>
  <li><a href="../source/stringx.lua.html">stringx.lua</a></li>
  <li><a href="../source/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../source/tablex.lua.html">tablex.lua</a></li>
  <li><a href="../source/template.lua.html">template.lua</a></li>
  <li><a href="../source/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../source/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../source/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../source/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../source/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../source/test.lua.html">test.lua</a></li>
  <li><a href="../source/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../source/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../source/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../source/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../source/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../source/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../source/testxml.lua.html">testxml.lua</a></li>
  <li><a href="../source/text.lua.html">text.lua</a></li>
  <li><a href="../source/types.lua.html">types.lua</a></li>
  <li><a href="../source/url.lua.html">url.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/which.lua.html">which.lua</a></li>
  <li><a href="../source/xml.lua.html">xml.lua</a></li>
</ul>
<h2>Libraries</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../libraries/pl.html">pl</a></li>
  <li><a href="../libraries/pl.app.html">pl.app</a></li>
  <li><a href="../libraries/pl.array2d.html">pl.array2d</a></li>
  <li><a href="../libraries/pl.class.html">pl.class</a></li>
  <li><a href="../libraries/pl.compat.html">pl.compat</a></li>
  <li><a href="../libraries/pl.comprehension.html">pl.comprehension</a></li>
  <li><a href="../libraries/pl.config.html">pl.config</a></li>
  <li><a href="../libraries/pl.data.html">pl.data</a></li>
  <li><a href="../libraries/pl.dir.html">pl.dir</a></li>
  <li><a href="../libraries/pl.file.html">pl.file</a></li>
  <li><a href="../libraries/pl.func.html">pl.func</a></li>
  <li><a href="../libraries/pl.import_into.html">pl.import_into</a></li>
  <li><a href="../libraries/pl.input.html">pl.input</a></li>
  <li><a href="../libraries/pl.lapp.html">pl.lapp</a></li>
  <li><a href="../libraries/pl.lexer.html">pl.lexer</a></li>
  <li><a href="../libraries/pl.luabalanced.html">pl.luabalanced</a></li>
  <li><a href="../libraries/pl.operator.html">pl.operator</a></li>
  <li><a href="../libraries/pl.path.html">pl.path</a></li>
  <li><a href="../libraries/pl.permute.html">pl.permute</a></li>
  <li><a href="../libraries/pl.pretty.html">pl.pretty</a></li>
  <li><a href="../libraries/pl.seq.html">pl.seq</a></li>
  <li><a href="../libraries/pl.sip.html">pl.sip</a></li>
  <li><a href="../libraries/pl.strict.html">pl.strict</a></li>
  <li><a href="../libraries/pl.stringio.html">pl.stringio</a></li>
  <li><a href="../libraries/pl.stringx.html">pl.stringx</a></li>
  <li><a href="../libraries/pl.tablex.html">pl.tablex</a></li>
  <li><a href="../libraries/pl.template.html">pl.template</a></li>
  <li><a href="../libraries/pl.test.html">pl.test</a></li>
  <li><a href="../libraries/pl.text.html">pl.text</a></li>
  <li><a href="../libraries/pl.types.html">pl.types</a></li>
  <li><a href="../libraries/pl.url.html">pl.url</a></li>
  <li><a href="../libraries/pl.utils.html">pl.utils</a></li>
  <li><a href="../libraries/pl.xml.html">pl.xml</a></li>
</ul>
<h2>Classes</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../classes/pl.Date.html">pl.Date</a></li>
  <li><a href="../classes/pl.List.html">pl.List</a></li>
  <li><a href="../classes/pl.Map.html">pl.Map</a></li>
  <li><a href="../classes/pl.MultiMap.html">pl.MultiMap</a></li>
  <li><a href="../classes/pl.OrderedMap.html">pl.OrderedMap</a></li>
  <li><a href="../classes/pl.Set.html">pl.Set</a></li>
</ul>
<h2>Manual</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
  <li><a href="../manual/02-arrays.md.html">Tables and Arrays</a></li>
  <li><a href="../manual/03-strings.md.html">Strings. Higher-level operations on strings.</a></li>
  <li><a href="../manual/04-paths.md.html">Paths and Directories</a></li>
  <li><a href="../manual/05-dates.md.html">Date and Time</a></li>
  <li><a href="../manual/06-data.md.html">Data</a></li>
  <li><a href="../manual/07-functional.md.html">Functional Programming</a></li>
  <li><a href="../manual/08-additional.md.html">Additional Libraries</a></li>
  <li><a href="../manual/09-discussion.md.html">Technical Choices</a></li>
</ul>
<h2>Examples</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../examples/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../examples/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../examples/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../examples/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../examples/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../examples/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../examples/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../examples/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../examples/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../examples/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../examples/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../examples/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../examples/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../examples/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../examples/testxml.lua.html">testxml.lua</a></li>
  <li><a href="../examples/which.lua.html">which.lua</a></li>
</ul>

</div>

<div id="content">

    <h2>class.lua</h2>
<pre>
<span class="comment">--- Provides a reuseable and convenient framework for creating classes in Lua.
</span><span class="comment">-- Two possible notations:
</span><span class="comment">--
</span><span class="comment">--    B = class(A)
</span><span class="comment">--    class.B(A)
</span><span class="comment">--
</span><span class="comment">-- The latter form creates a named class within the current environment. Note
</span><span class="comment">-- that this implicitly brings in <a href="../libraries/pl.utils.html#">pl.utils</a> as a dependency.
</span><span class="comment">--
</span><span class="comment">-- See the Guide for further <a href="../manual/01-introduction.md.html#Simplifying_Object_Oriented_Programming_in_Lua">discussion</a>
</span><span class="comment">-- @module pl.class
</span>
<span class="keyword">local</span> error, <span class="global">getmetatable</span>, <span class="global">io</span>, <span class="global">pairs</span>, <span class="global">rawget</span>, <span class="global">rawset</span>, <span class="global">setmetatable</span>, <span class="global">tostring</span>, <span class="global">type</span> =
    _G.error, _G.<span class="global">getmetatable</span>, _G.<span class="global">io</span>, _G.<span class="global">pairs</span>, _G.<span class="global">rawget</span>, _G.<span class="global">rawset</span>, _G.<span class="global">setmetatable</span>, _G.<span class="global">tostring</span>, _G.<span class="global">type</span>
<span class="keyword">local</span> compat

<span class="comment">-- this trickery is necessary to prevent the inheritance of 'super' and
</span><span class="comment">-- the resulting recursive call problems.
</span><span class="keyword">local</span> <span class="keyword">function</span> call_ctor (c,obj,...)
    <span class="comment">-- nice alias for the base class ctor
</span>    <span class="keyword">local</span> base = <span class="global">rawget</span>(c,<span class="string">'_base'</span>)
    <span class="keyword">if</span> base <span class="keyword">then</span>
        <span class="keyword">local</span> parent_ctor = <span class="global">rawget</span>(base,<span class="string">'_init'</span>)
        <span class="keyword">while</span> <span class="keyword">not</span> parent_ctor <span class="keyword">do</span>
            base = <span class="global">rawget</span>(base,<span class="string">'_base'</span>)
            <span class="keyword">if</span> <span class="keyword">not</span> base <span class="keyword">then</span> <span class="keyword">break</span> <span class="keyword">end</span>
            parent_ctor = <span class="global">rawget</span>(base,<span class="string">'_init'</span>)
        <span class="keyword">end</span>
        <span class="keyword">if</span> parent_ctor <span class="keyword">then</span>
            <span class="global">rawset</span>(obj,<span class="string">'super'</span>,<span class="keyword">function</span>(obj,...)
                call_ctor(base,obj,...)
            <span class="keyword">end</span>)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">local</span> res = c._init(obj,...)
    <span class="global">rawset</span>(obj,<span class="string">'super'</span>,<span class="keyword">nil</span>)
    <span class="keyword">return</span> res
<span class="keyword">end</span>

<span class="comment">--- initializes an __instance__ upon creation.
</span><span class="comment">-- @function class:_init
</span><span class="comment">-- @param ... parameters passed to the constructor
</span><span class="comment">-- @usage local Cat = class()
</span><span class="comment">-- function Cat:_init(name)
</span><span class="comment">--   --self:super(name)   -- call the ancestor initializer if needed
</span><span class="comment">--   self.name = name
</span><span class="comment">-- end
</span><span class="comment">--
</span><span class="comment">-- local pussycat = Cat("pussycat")
</span><span class="comment">-- print(pussycat.name)  --&gt; pussycat
</span><a id="52"></a>
<span class="comment">--- checks whether an __instance__ is derived from some class.
</span><span class="comment">-- Works the other way around as <code>class_of</code>.
</span><span class="comment">-- @function instance:is_a
</span><span class="comment">-- @param some_class class to check against
</span><span class="comment">-- @return <code>true</code> if <code>instance</code> is derived from <code>some_class</code>
</span><span class="comment">-- @usage local pussycat = Lion()  -- assuming Lion derives from Cat
</span><span class="comment">-- if pussycat:is_a(Cat) then
</span><span class="comment">--   -- it's true
</span><a id="61"></a><span class="comment">-- end
</span><span class="keyword">local</span> <span class="keyword">function</span> is_a(self,klass)
    <span class="keyword">local</span> m = <span class="global">getmetatable</span>(self)
    <span class="keyword">if</span> <span class="keyword">not</span> m <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">end</span> <span class="comment">--*can't be an object!
</span>    <span class="keyword">while</span> m <span class="keyword">do</span>
        <span class="keyword">if</span> m == klass <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">true</span> <span class="keyword">end</span>
        m = <span class="global">rawget</span>(m,<span class="string">'_base'</span>)
    <span class="keyword">end</span>
    <span class="keyword">return</span> <span class="keyword">false</span>
<span class="keyword">end</span>

<span class="comment">--- checks whether an __instance__ is derived from some class.
</span><span class="comment">-- Works the other way around as <code>is_a</code>.
</span><span class="comment">-- @function some_class:class_of
</span><span class="comment">-- @param some_instance instance to check against
</span><span class="comment">-- @return <code>true</code> if <code>some_instance</code> is derived from <code>some_class</code>
</span><span class="comment">-- @usage local pussycat = Lion()  -- assuming Lion derives from Cat
</span><span class="comment">-- if Cat:class_of(pussycat) then
</span><span class="comment">--   -- it's true
</span><a id="80"></a><span class="comment">-- end
</span><span class="keyword">local</span> <span class="keyword">function</span> class_of(klass,obj)
    <span class="keyword">if</span> <span class="global">type</span>(klass) ~= <span class="string">'table'</span> <span class="keyword">or</span> <span class="keyword">not</span> <span class="global">rawget</span>(klass,<span class="string">'is_a'</span>) <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">false</span> <span class="keyword">end</span>
    <span class="keyword">return</span> klass.is_a(obj,klass)
<span class="keyword">end</span>

<span class="comment">--- cast an object to another class.
</span><span class="comment">-- It is not clever (or safe!) so use carefully.
</span><span class="comment">-- @param some_instance the object to be changed
</span><a id="89"></a><span class="comment">-- @function some_class:cast
</span><span class="keyword">local</span> <span class="keyword">function</span> cast (klass, obj)
    <span class="keyword">return</span> <span class="global">setmetatable</span>(obj,klass)
<span class="keyword">end</span>


<span class="keyword">local</span> <span class="keyword">function</span> _class_tostring (obj)
    <span class="keyword">local</span> mt = obj._class
    <span class="keyword">local</span> name = <span class="global">rawget</span>(mt,<span class="string">'_name'</span>)
    <span class="global">setmetatable</span>(obj,<span class="keyword">nil</span>)
    <span class="keyword">local</span> str = <span class="global">tostring</span>(obj)
    <span class="global">setmetatable</span>(obj,mt)
    <span class="keyword">if</span> name <span class="keyword">then</span> str = name ..str:gsub(<span class="string">'table'</span>,<span class="string">''</span>) <span class="keyword">end</span>
    <span class="keyword">return</span> str
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> tupdate(td,ts,dont_override)
    <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="global">pairs</span>(ts) <span class="keyword">do</span>
        <span class="keyword">if</span> <span class="keyword">not</span> dont_override <span class="keyword">or</span> td[k] == <span class="keyword">nil</span> <span class="keyword">then</span>
            td[k] = v
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> _class(base,c_arg,c)
    <span class="comment">-- the class <code>c</code> will be the metatable for all its objects,
</span>    <span class="comment">-- and they will look up their methods in it.
</span>    <span class="keyword">local</span> mt = {}   <span class="comment">-- a metatable for the class to support __call and _handler
</span>    <span class="comment">-- can define class by passing it a plain table of methods
</span>    <span class="keyword">local</span> plain = <span class="global">type</span>(base) == <span class="string">'table'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="global">getmetatable</span>(base)
    <span class="keyword">if</span> plain <span class="keyword">then</span>
        c = base
        base = c._base
    <span class="keyword">else</span>
        c = c <span class="keyword">or</span> {}
    <span class="keyword">end</span>

    <span class="keyword">if</span> <span class="global">type</span>(base) == <span class="string">'table'</span> <span class="keyword">then</span>
        <span class="comment">-- our new class is a shallow copy of the base class!
</span>        <span class="comment">-- but be careful not to wipe out any methods we have been given at this point!
</span>        tupdate(c,base,plain)
        c._base = base
        <span class="comment">-- inherit the 'not found' handler, if present
</span>        <span class="keyword">if</span> <span class="global">rawget</span>(c,<span class="string">'_handler'</span>) <span class="keyword">then</span> mt.__index = c._handler <span class="keyword">end</span>
    <span class="keyword">elseif</span> base ~= <span class="keyword">nil</span> <span class="keyword">then</span>
        error(<span class="string">"must derive from a table type"</span>,<span class="number">3</span>)
    <span class="keyword">end</span>

    c.__index = c
    <span class="global">setmetatable</span>(c,mt)
    <span class="keyword">if</span> <span class="keyword">not</span> plain <span class="keyword">then</span>
        c._init = <span class="keyword">nil</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> base <span class="keyword">and</span> <span class="global">rawget</span>(base,<span class="string">'_class_init'</span>) <span class="keyword">then</span>
        base._class_init(c,c_arg)
    <span class="keyword">end</span>

    <span class="comment">-- expose a ctor which can be called by &lt;classname&gt;(&lt;args&gt;)
</span>    mt.__call = <span class="keyword">function</span>(class_tbl,...)
        <span class="keyword">local</span> obj
        <span class="keyword">if</span> <span class="global">rawget</span>(c,<span class="string">'_create'</span>) <span class="keyword">then</span> obj = c._create(...) <span class="keyword">end</span>
        <span class="keyword">if</span> <span class="keyword">not</span> obj <span class="keyword">then</span> obj = {} <span class="keyword">end</span>
        <span class="global">setmetatable</span>(obj,c)

        <span class="keyword">if</span> <span class="global">rawget</span>(c,<span class="string">'_init'</span>) <span class="keyword">then</span> <span class="comment">-- explicit constructor
</span>            <span class="keyword">local</span> res = call_ctor(c,obj,...)
            <span class="keyword">if</span> res <span class="keyword">then</span> <span class="comment">-- _if_ a ctor returns a value, it becomes the object...
</span>                obj = res
                <span class="global">setmetatable</span>(obj,c)
            <span class="keyword">end</span>
        <span class="keyword">elseif</span> base <span class="keyword">and</span> <span class="global">rawget</span>(base,<span class="string">'_init'</span>) <span class="keyword">then</span> <span class="comment">-- default constructor
</span>            <span class="comment">-- make sure that any stuff from the base class is initialized!
</span>            call_ctor(base,obj,...)
        <span class="keyword">end</span>

        <span class="keyword">if</span> base <span class="keyword">and</span> <span class="global">rawget</span>(base,<span class="string">'_post_init'</span>) <span class="keyword">then</span>
            base._post_init(obj)
        <span class="keyword">end</span>

        <span class="keyword">if</span> <span class="keyword">not</span> <span class="global">rawget</span>(c,<span class="string">'__tostring'</span>) <span class="keyword">then</span>
            c.__tostring = _class_tostring
        <span class="keyword">end</span>
        <span class="keyword">return</span> obj
    <span class="keyword">end</span>
    <span class="comment">-- Call Class.catch to set a handler for methods/properties not found in the class!
</span>    c.catch = <span class="keyword">function</span>(self, handler)
        <span class="keyword">if</span> <span class="global">type</span>(self) == <span class="string">"function"</span> <span class="keyword">then</span>
            <span class="comment">-- called using . instead of :
</span>            handler = self
        <span class="keyword">end</span>
        c._handler = handler
        mt.__index = handler
    <span class="keyword">end</span>
    c.is_a = is_a
    c.class_of = class_of
    c.cast = cast
    c._class = c

    <span class="keyword">return</span> c
<span class="keyword">end</span>

<span class="comment">--- create a new class, derived from a given base class.
</span><span class="comment">-- Supporting two class creation syntaxes:
</span><span class="comment">-- either <code>Name = class(base)</code> or <code>class.Name(base)</code>.
</span><span class="comment">-- The first form returns the class directly and does not set its <code>_name</code>.
</span><span class="comment">-- The second form creates a variable <code>Name</code> in the current environment set
</span><span class="comment">-- to the class, and also sets <code>_name</code>.
</span><span class="comment">-- @function class
</span><span class="comment">-- @param base optional base class
</span><span class="comment">-- @param c_arg optional parameter to class constructor
</span><span class="comment">-- @param c optional table to be used as class
</span><span class="keyword">local</span> class<a id="201"></a>
class = <span class="global">setmetatable</span>({},{
    __call = <span class="keyword">function</span>(fun,...)
        <span class="keyword">return</span> _class(...)
    <span class="keyword">end</span>,
    __index = <span class="keyword">function</span>(tbl,key)
        <span class="keyword">if</span> key == <span class="string">'class'</span> <span class="keyword">then</span>
            <span class="global">io</span>.stderr:write(<span class="string">'require("pl.class").class is deprecated. Use require("pl.class")\n'</span>)
            <span class="keyword">return</span> class
        <span class="keyword">end</span>
        compat = compat <span class="keyword">or</span> <span class="global">require</span> <span class="string">'pl.compat'</span>
        <span class="keyword">local</span> env = compat.<span class="global">getfenv</span>(<span class="number">2</span>)
        <span class="keyword">return</span> <span class="keyword">function</span>(...)
            <span class="keyword">local</span> c = _class(...)
            c._name = key
            <span class="global">rawset</span>(env,key,c)
            <span class="keyword">return</span> c
        <span class="keyword">end</span>
    <span class="keyword">end</span>
})

class.properties = class()

<span class="keyword">function</span> class.properties._class_init(klass)
    klass.__index = <span class="keyword">function</span>(t,key)
        <span class="comment">-- normal class lookup!
</span>        <span class="keyword">local</span> v = klass[key]
        <span class="keyword">if</span> v <span class="keyword">then</span> <span class="keyword">return</span> v <span class="keyword">end</span>
        <span class="comment">-- is it a getter?
</span>        v = <span class="global">rawget</span>(klass,<span class="string">'get_'</span>..key)
        <span class="keyword">if</span> v <span class="keyword">then</span>
            <span class="keyword">return</span> v(t)
        <span class="keyword">end</span>
        <span class="comment">-- is it a field?
</span>        <span class="keyword">return</span> <span class="global">rawget</span>(t,<span class="string">'_'</span>..key)
    <span class="keyword">end</span>
    klass.__newindex = <span class="keyword">function</span> (t,key,value)
        <span class="comment">-- if there's a setter, use that, otherwise directly set table
</span>        <span class="keyword">local</span> p = <span class="string">'set_'</span>..key
        <span class="keyword">local</span> setter = klass[p]
        <span class="keyword">if</span> setter <span class="keyword">then</span>
            setter(t,value)
        <span class="keyword">else</span>
            <span class="global">rawset</span>(t,key,value)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="keyword">return</span> class</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.3</a></i>
<i style="float:right;">Last updated 2014-11-01 18:36:39 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
