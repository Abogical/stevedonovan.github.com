<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Penlight Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Penlight</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../source/app.lua.html">app.lua</a></li>
  <li><a href="../source/array2d.lua.html">array2d.lua</a></li>
  <li><a href="../source/class.lua.html">class.lua</a></li>
  <li><a href="../source/compat.lua.html">compat.lua</a></li>
  <li><a href="../source/comprehension.lua.html">comprehension.lua</a></li>
  <li><a href="../source/config.lua.html">config.lua</a></li>
  <li><a href="../source/data.lua.html">data.lua</a></li>
  <li><a href="../source/date.lua.html">date.lua</a></li>
  <li><a href="../source/dir.lua.html">dir.lua</a></li>
  <li><a href="../source/file.lua.html">file.lua</a></li>
  <li><a href="../source/func.lua.html">func.lua</a></li>
  <li><a href="../source/import_into.lua.html">import_into.lua</a></li>
  <li><a href="../source/init.lua.html">init.lua</a></li>
  <li><a href="../source/input.lua.html">input.lua</a></li>
  <li><a href="../source/lapp.lua.html">lapp.lua</a></li>
  <li><a href="../source/lexer.lua.html">lexer.lua</a></li>
  <li><a href="../source/list.lua.html">list.lua</a></li>
  <li><a href="../source/luabalanced.lua.html">luabalanced.lua</a></li>
  <li><a href="../source/map.lua.html">map.lua</a></li>
  <li><a href="../source/multimap.lua.html">multimap.lua</a></li>
  <li><a href="../source/operator.lua.html">operator.lua</a></li>
  <li><a href="../source/orderedmap.lua.html">orderedmap.lua</a></li>
  <li><a href="../source/path.lua.html">path.lua</a></li>
  <li><a href="../source/permute.lua.html">permute.lua</a></li>
  <li><a href="../source/pretty.lua.html">pretty.lua</a></li>
  <li><a href="../source/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../source/seq.lua.html">seq.lua</a></li>
  <li><a href="../source/set.lua.html">set.lua</a></li>
  <li><a href="../source/sip.lua.html">sip.lua</a></li>
  <li><a href="../source/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../source/strict.lua.html">strict.lua</a></li>
  <li><a href="../source/stringio.lua.html">stringio.lua</a></li>
  <li><a href="../source/stringx.lua.html">stringx.lua</a></li>
  <li><a href="../source/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../source/tablex.lua.html">tablex.lua</a></li>
  <li><a href="../source/template.lua.html">template.lua</a></li>
  <li><a href="../source/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../source/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../source/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../source/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../source/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../source/test.lua.html">test.lua</a></li>
  <li><a href="../source/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../source/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../source/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../source/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../source/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../source/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../source/testxml.lua.html">testxml.lua</a></li>
  <li><strong>text.lua</strong></li>
  <li><a href="../source/types.lua.html">types.lua</a></li>
  <li><a href="../source/url.lua.html">url.lua</a></li>
  <li><a href="../source/utils.lua.html">utils.lua</a></li>
  <li><a href="../source/which.lua.html">which.lua</a></li>
  <li><a href="../source/xml.lua.html">xml.lua</a></li>
</ul>
<h2>Libraries</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../libraries/pl.html">pl</a></li>
  <li><a href="../libraries/pl.app.html">pl.app</a></li>
  <li><a href="../libraries/pl.array2d.html">pl.array2d</a></li>
  <li><a href="../libraries/pl.class.html">pl.class</a></li>
  <li><a href="../libraries/pl.compat.html">pl.compat</a></li>
  <li><a href="../libraries/pl.comprehension.html">pl.comprehension</a></li>
  <li><a href="../libraries/pl.config.html">pl.config</a></li>
  <li><a href="../libraries/pl.data.html">pl.data</a></li>
  <li><a href="../libraries/pl.dir.html">pl.dir</a></li>
  <li><a href="../libraries/pl.file.html">pl.file</a></li>
  <li><a href="../libraries/pl.func.html">pl.func</a></li>
  <li><a href="../libraries/pl.import_into.html">pl.import_into</a></li>
  <li><a href="../libraries/pl.input.html">pl.input</a></li>
  <li><a href="../libraries/pl.lapp.html">pl.lapp</a></li>
  <li><a href="../libraries/pl.lexer.html">pl.lexer</a></li>
  <li><a href="../libraries/pl.luabalanced.html">pl.luabalanced</a></li>
  <li><a href="../libraries/pl.operator.html">pl.operator</a></li>
  <li><a href="../libraries/pl.path.html">pl.path</a></li>
  <li><a href="../libraries/pl.permute.html">pl.permute</a></li>
  <li><a href="../libraries/pl.pretty.html">pl.pretty</a></li>
  <li><a href="../libraries/pl.seq.html">pl.seq</a></li>
  <li><a href="../libraries/pl.sip.html">pl.sip</a></li>
  <li><a href="../libraries/pl.strict.html">pl.strict</a></li>
  <li><a href="../libraries/pl.stringio.html">pl.stringio</a></li>
  <li><a href="../libraries/pl.stringx.html">pl.stringx</a></li>
  <li><a href="../libraries/pl.tablex.html">pl.tablex</a></li>
  <li><a href="../libraries/pl.template.html">pl.template</a></li>
  <li><a href="../libraries/pl.test.html">pl.test</a></li>
  <li><a href="../libraries/pl.text.html">pl.text</a></li>
  <li><a href="../libraries/pl.types.html">pl.types</a></li>
  <li><a href="../libraries/pl.url.html">pl.url</a></li>
  <li><a href="../libraries/pl.utils.html">pl.utils</a></li>
  <li><a href="../libraries/pl.xml.html">pl.xml</a></li>
</ul>
<h2>Classes</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../classes/pl.Date.html">pl.Date</a></li>
  <li><a href="../classes/pl.List.html">pl.List</a></li>
  <li><a href="../classes/pl.Map.html">pl.Map</a></li>
  <li><a href="../classes/pl.MultiMap.html">pl.MultiMap</a></li>
  <li><a href="../classes/pl.OrderedMap.html">pl.OrderedMap</a></li>
  <li><a href="../classes/pl.Set.html">pl.Set</a></li>
</ul>
<h2>Manual</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
  <li><a href="../manual/02-arrays.md.html">Tables and Arrays</a></li>
  <li><a href="../manual/03-strings.md.html">Strings. Higher-level operations on strings.</a></li>
  <li><a href="../manual/04-paths.md.html">Paths and Directories</a></li>
  <li><a href="../manual/05-dates.md.html">Date and Time</a></li>
  <li><a href="../manual/06-data.md.html">Data</a></li>
  <li><a href="../manual/07-functional.md.html">Functional Programming</a></li>
  <li><a href="../manual/08-additional.md.html">Additional Libraries</a></li>
  <li><a href="../manual/09-discussion.md.html">Technical Choices</a></li>
</ul>
<h2>Examples</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../examples/seesubst.lua.html">seesubst.lua</a></li>
  <li><a href="../examples/sipscan.lua.html">sipscan.lua</a></li>
  <li><a href="../examples/symbols.lua.html">symbols.lua</a></li>
  <li><a href="../examples/test-cmp.lua.html">test-cmp.lua</a></li>
  <li><a href="../examples/test-data.lua.html">test-data.lua</a></li>
  <li><a href="../examples/test-listcallbacks.lua.html">test-listcallbacks.lua</a></li>
  <li><a href="../examples/test-pretty.lua.html">test-pretty.lua</a></li>
  <li><a href="../examples/test-symbols.lua.html">test-symbols.lua</a></li>
  <li><a href="../examples/testapp.lua.html">testapp.lua</a></li>
  <li><a href="../examples/testclone.lua.html">testclone.lua</a></li>
  <li><a href="../examples/testconfig.lua.html">testconfig.lua</a></li>
  <li><a href="../examples/testglobal.lua.html">testglobal.lua</a></li>
  <li><a href="../examples/testinputfields.lua.html">testinputfields.lua</a></li>
  <li><a href="../examples/testinputfields2.lua.html">testinputfields2.lua</a></li>
  <li><a href="../examples/testxml.lua.html">testxml.lua</a></li>
  <li><a href="../examples/which.lua.html">which.lua</a></li>
</ul>

</div>

<div id="content">

    <h2>text.lua</h2>
<pre>
<span class="comment">--- Text processing utilities.
</span><span class="comment">--
</span><span class="comment">-- This provides a Template class (modeled after the same from the Python
</span><span class="comment">-- libraries, see string.Template). It also provides similar functions to those
</span><span class="comment">-- found in the textwrap module.
</span><span class="comment">--
</span><span class="comment">-- See  <a href="../manual/03-strings.md.html#String_Templates">the Guide</a>.
</span><span class="comment">--
</span><span class="comment">-- Calling <code>text.format_operator()</code> overloads the % operator for strings to give Python/Ruby style formated output.
</span><span class="comment">-- This is extended to also do template-like substitution for map-like data.
</span><span class="comment">--
</span><span class="comment">--    &gt; require 'pl.text'.format_operator()
</span><span class="comment">--    &gt; = '%s = %5.3f' % {'PI',math.pi}
</span><span class="comment">--    PI = 3.142
</span><span class="comment">--    &gt; = '$name = $value' % {name='dog',value='Pluto'}
</span><span class="comment">--    dog = Pluto
</span><span class="comment">--
</span><span class="comment">-- Dependencies: <a href="../libraries/pl.utils.html#">pl.utils</a>, <a href="../libraries/pl.types.html#">pl.types</a>
</span><span class="comment">-- @module pl.text
</span>
<span class="keyword">local</span> gsub = <span class="global">string</span>.gsub
<span class="keyword">local</span> concat,append = <span class="global">table</span>.concat,<span class="global">table</span>.insert
<span class="keyword">local</span> utils = <span class="global">require</span> <span class="string">'pl.utils'</span>
<span class="keyword">local</span> bind1,usplit,assert_arg = utils.bind1,utils.split,utils.assert_arg
<span class="keyword">local</span> is_callable = <span class="global">require</span> <span class="string">'pl.types'</span>.is_callable
<span class="keyword">local</span> <span class="global">unpack</span> = utils.<span class="global">unpack</span>

<span class="keyword">local</span> <span class="keyword">function</span> lstrip(str)  <span class="keyword">return</span> (str:gsub(<span class="string">'^%s+'</span>,<span class="string">''</span>))  <span class="keyword">end</span>
<span class="keyword">local</span> <span class="keyword">function</span> strip(str)  <span class="keyword">return</span> (lstrip(str):gsub(<span class="string">'%s+$'</span>,<span class="string">''</span>)) <span class="keyword">end</span>
<span class="keyword">local</span> <span class="keyword">function</span> make_list(l)  <span class="keyword">return</span> <span class="global">setmetatable</span>(l,utils.stdmt.List) <span class="keyword">end</span>
<span class="keyword">local</span> <span class="keyword">function</span> split(s,delim)  <span class="keyword">return</span> make_list(usplit(s,delim)) <span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> imap(f,t,...)
    <span class="keyword">local</span> res = {}
    <span class="keyword">for</span> i = <span class="number">1</span>,#t <span class="keyword">do</span> res[i] = f(t[i],...) <span class="keyword">end</span>
    <span class="keyword">return</span> res
<span class="keyword">end</span>

<span class="comment">--[[
module ('pl.text',utils._module)
]]</span>

<span class="keyword">local</span> text = {}

<span class="keyword">local</span> <span class="keyword">function</span> _indent (s,sp)
    <span class="keyword">local</span> sl = split(s,<span class="string">'\n'</span>)
    <span class="keyword">return</span> concat(imap(bind1(<span class="string">'..'</span>,sp),sl),<span class="string">'\n'</span>)..<span class="string">'\n'</span>
<span class="keyword">end</span>

<span class="comment">--- indent a multiline string.
</span><span class="comment">-- @param s the string
</span><span class="comment">-- @param n the size of the indent
</span><span class="comment">-- @param ch the character to use when indenting (default ' ')
</span><a id="55"></a><span class="comment">-- @return indented string
</span><span class="keyword">function</span> text.indent (s,n,ch)
    assert_arg(<span class="number">1</span>,s,<span class="string">'string'</span>)
    assert_arg(<span class="number">2</span>,n,<span class="string">'number'</span>)
    <span class="keyword">return</span> _indent(s,<span class="global">string</span>.rep(ch <span class="keyword">or</span> <span class="string">' '</span>,n))
<span class="keyword">end</span>

<span class="comment">--- dedent a multiline string by removing any initial indent.
</span><span class="comment">-- useful when working with [[..]] strings.
</span><span class="comment">-- @param s the string
</span><a id="65"></a><span class="comment">-- @return a string with initial indent zero.
</span><span class="keyword">function</span> text.dedent (s)
    assert_arg(<span class="number">1</span>,s,<span class="string">'string'</span>)
    <span class="keyword">local</span> sl = split(s,<span class="string">'\n'</span>)
    <span class="keyword">local</span> i1,i2 = sl[<span class="number">1</span>]:find(<span class="string">'^%s*'</span>)
    sl = imap(<span class="global">string</span>.sub,sl,i2+<span class="number">1</span>)
    <span class="keyword">return</span> concat(sl,<span class="string">'\n'</span>)..<span class="string">'\n'</span>
<span class="keyword">end</span>

<span class="comment">--- format a paragraph into lines so that they fit into a line width.
</span><span class="comment">-- It will not break long words, so lines can be over the length
</span><span class="comment">-- to that extent.
</span><span class="comment">-- @param s the string
</span><span class="comment">-- @param width the margin width, default 70
</span><a id="79"></a><span class="comment">-- @return a list of lines
</span><span class="keyword">function</span> text.wrap (s,width)
    assert_arg(<span class="number">1</span>,s,<span class="string">'string'</span>)
    width = width <span class="keyword">or</span> <span class="number">70</span>
    s = s:gsub(<span class="string">'\n'</span>,<span class="string">' '</span>)
    <span class="keyword">local</span> i,nxt = <span class="number">1</span>
    <span class="keyword">local</span> lines,line = {}
    <span class="keyword">while</span> i &lt; #s <span class="keyword">do</span>
        nxt = i+width
        <span class="keyword">if</span> s:find(<span class="string">"[%w']"</span>,nxt) <span class="keyword">then</span> <span class="comment">-- inside a word
</span>            nxt = s:find(<span class="string">'%W'</span>,nxt+<span class="number">1</span>) <span class="comment">-- so find word boundary
</span>        <span class="keyword">end</span>
        line = s:sub(i,nxt)
        i = i + #line
        append(lines,strip(line))
    <span class="keyword">end</span>
    <span class="keyword">return</span> make_list(lines)
<span class="keyword">end</span>

<span class="comment">--- format a paragraph so that it fits into a line width.
</span><span class="comment">-- @param s the string
</span><span class="comment">-- @param width the margin width, default 70
</span><span class="comment">-- @return a string
</span><a id="102"></a><span class="comment">-- @see wrap
</span><span class="keyword">function</span> text.fill (s,width)
    <span class="keyword">return</span> concat(text.wrap(s,width),<span class="string">'\n'</span>) .. <span class="string">'\n'</span>
<span class="keyword">end</span>

<span class="keyword">local</span> Template = {}
text.Template = Template
Template.__index = Template
<span class="global">setmetatable</span>(Template, {
    __call = <span class="keyword">function</span>(obj,tmpl)
        <span class="keyword">return</span> Template.new(tmpl)
    <span class="keyword">end</span>})

<span class="keyword">function</span> Template.new(tmpl)
    assert_arg(<span class="number">1</span>,tmpl,<span class="string">'string'</span>)
    <span class="keyword">local</span> res = {}
    res.tmpl = tmpl
    <span class="global">setmetatable</span>(res,Template)
    <span class="keyword">return</span> res
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> _substitute(s,tbl,safe)
    <span class="keyword">local</span> subst
    <span class="keyword">if</span> is_callable(tbl) <span class="keyword">then</span>
        subst = tbl
    <span class="keyword">else</span>
        <span class="keyword">function</span> subst(f)
            <span class="keyword">local</span> s = tbl[f]
            <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">then</span>
                <span class="keyword">if</span> safe <span class="keyword">then</span>
                    <span class="keyword">return</span> f
                <span class="keyword">else</span>
                    error(<span class="string">"not present in table "</span>..f)
                <span class="keyword">end</span>
            <span class="keyword">else</span>
                <span class="keyword">return</span> s
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">local</span> res = gsub(s,<span class="string">'%${([%w_]+)}'</span>,subst)
    <span class="keyword">return</span> (gsub(res,<span class="string">'%$([%w_]+)'</span>,subst))
<span class="keyword">end</span>

<span class="comment">--- substitute values into a template, throwing an error.
</span><span class="comment">-- This will throw an error if no name is found.
</span><a id="147"></a><span class="comment">-- @param tbl a table of name-value pairs.
</span><span class="keyword">function</span> Template:substitute(tbl)
    assert_arg(<span class="number">1</span>,tbl,<span class="string">'table'</span>)
    <span class="keyword">return</span> _substitute(self.tmpl,tbl,<span class="keyword">false</span>)
<span class="keyword">end</span>

<span class="comment">--- substitute values into a template.
</span><span class="comment">-- This version just passes unknown names through.
</span><a id="155"></a><span class="comment">-- @param tbl a table of name-value pairs.
</span><span class="keyword">function</span> Template:safe_substitute(tbl)
    assert_arg(<span class="number">1</span>,tbl,<span class="string">'table'</span>)
    <span class="keyword">return</span> _substitute(self.tmpl,tbl,<span class="keyword">true</span>)
<span class="keyword">end</span>

<span class="comment">--- substitute values into a template, preserving indentation. &lt;br&gt;
</span><span class="comment">-- If the value is a multiline string _or_ a template, it will insert
</span><span class="comment">-- the lines at the correct indentation. &lt;br&gt;
</span><span class="comment">-- Furthermore, if a template, then that template will be subsituted
</span><span class="comment">-- using the same table.
</span><a id="166"></a><span class="comment">-- @param tbl a table of name-value pairs.
</span><span class="keyword">function</span> Template:indent_substitute(tbl)
    assert_arg(<span class="number">1</span>,tbl,<span class="string">'table'</span>)
    <span class="keyword">if</span> <span class="keyword">not</span> self.strings <span class="keyword">then</span>
        self.strings = split(self.tmpl,<span class="string">'\n'</span>)
    <span class="keyword">end</span>
    <span class="comment">-- the idea is to substitute line by line, grabbing any spaces as
</span>    <span class="comment">-- well as the $var. If the value to be substituted contains newlines,
</span>    <span class="comment">-- then we split that into lines and adjust the indent before inserting.
</span>    <span class="keyword">local</span> <span class="keyword">function</span> subst(line)
        <span class="keyword">return</span> line:gsub(<span class="string">'(%s*)%$([%w_]+)'</span>,<span class="keyword">function</span>(sp,f)
			<span class="keyword">local</span> subtmpl
            <span class="keyword">local</span> s = tbl[f]
            <span class="keyword">if</span> <span class="keyword">not</span> s <span class="keyword">then</span> error(<span class="string">"not present in table "</span>..f) <span class="keyword">end</span>
			<span class="keyword">if</span> <span class="global">getmetatable</span>(s) == Template <span class="keyword">then</span>
				subtmpl = s
				s = s.tmpl
			<span class="keyword">else</span>
				s = <span class="global">tostring</span>(s)
			<span class="keyword">end</span>
            <span class="keyword">if</span> s:find <span class="string">'\n'</span> <span class="keyword">then</span>
                s = _indent(s,sp)
            <span class="keyword">end</span>
			<span class="keyword">if</span> subtmpl <span class="keyword">then</span> <span class="keyword">return</span> _substitute(s,tbl)
			<span class="keyword">else</span> <span class="keyword">return</span> s
			<span class="keyword">end</span>
        <span class="keyword">end</span>)
    <span class="keyword">end</span>
    <span class="keyword">local</span> lines = imap(subst,self.strings)
    <span class="keyword">return</span> concat(lines,<span class="string">'\n'</span>)..<span class="string">'\n'</span>
<span class="keyword">end</span>

<span class="comment">------- Python-style formatting operator ------
</span><span class="comment">-- (see &lt;a href="http://lua-users.org/wiki/StringInterpolation"&gt;the lua-users wiki&lt;/a&gt;) --
</span>
<span class="keyword">function</span> text.format_operator()

    <span class="keyword">local</span> format = <span class="global">string</span>.format

    <span class="comment">-- a more forgiving version of string.format, which applies
</span>    <span class="comment">-- tostring() to any value with a %s format.
</span>    <span class="keyword">local</span> <span class="keyword">function</span> formatx (fmt,...)
        <span class="keyword">local</span> args = {...}
        <span class="keyword">local</span> i = <span class="number">1</span>
        <span class="keyword">for</span> p <span class="keyword">in</span> fmt:gmatch(<span class="string">'%%.'</span>) <span class="keyword">do</span>
            <span class="keyword">if</span> p == <span class="string">'%s'</span> <span class="keyword">and</span> <span class="global">type</span>(args[i]) ~= <span class="string">'string'</span> <span class="keyword">then</span>
                args[i] = <span class="global">tostring</span>(args[i])
            <span class="keyword">end</span>
            i = i + <span class="number">1</span>
        <span class="keyword">end</span>
        <span class="keyword">return</span> format(fmt,<span class="global">unpack</span>(args))
    <span class="keyword">end</span>

    <span class="keyword">local</span> <span class="keyword">function</span> basic_subst(s,t)
        <span class="keyword">return</span> (s:gsub(<span class="string">'%$([%w_]+)'</span>,t))
    <span class="keyword">end</span>

    <span class="comment">-- Note this goes further than the original, and will allow these cases:
</span>    <span class="comment">-- 1. a single value
</span>    <span class="comment">-- 2. a list of values
</span>    <span class="comment">-- 3. a map of var=value pairs
</span>    <span class="comment">-- 4. a function, as in gsub
</span>    <span class="comment">-- For the second two cases, it uses $-variable substituion.
</span>    <span class="global">getmetatable</span>(<span class="string">""</span>).__mod = <span class="keyword">function</span>(a, b)
        <span class="keyword">if</span> b == <span class="keyword">nil</span> <span class="keyword">then</span>
            <span class="keyword">return</span> a
        <span class="keyword">elseif</span> <span class="global">type</span>(b) == <span class="string">"table"</span> <span class="keyword">and</span> <span class="global">getmetatable</span>(b) == <span class="keyword">nil</span> <span class="keyword">then</span>
            <span class="keyword">if</span> #b == <span class="number">0</span> <span class="keyword">then</span> <span class="comment">-- assume a map-like table
</span>                <span class="keyword">return</span> _substitute(a,b,<span class="keyword">true</span>)
            <span class="keyword">else</span>
                <span class="keyword">return</span> formatx(a,<span class="global">unpack</span>(b))
            <span class="keyword">end</span>
        <span class="keyword">elseif</span> <span class="global">type</span>(b) == <span class="string">'function'</span> <span class="keyword">then</span>
            <span class="keyword">return</span> basic_subst(a,b)
        <span class="keyword">else</span>
            <span class="keyword">return</span> formatx(a,b)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">return</span> text</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.3</a></i>
<i style="float:right;">Last updated 2014-11-01 18:36:39 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
